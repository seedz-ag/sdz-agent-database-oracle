SELECT
  D2_FILIAL,
  F2_FILIAL,
  A1_FILIAL,
  B1_FILIAL,
  (
    D2_FILIAL || D2_DOC || D2_SERIE || D2_EMISSAO || D2_CLIENTE || D2_LOJA || D2_ITEM
  ) id,
  D2_DOC,
  D2_SERIE,
  D2_EMISSAO,
  D2_PEDIDO,
  D2_TIPO,
  D2_COD,
  B1_DESC,
  B1_COD,
  D2_UM,
  D2_QUANT,
  D2_PRCVEN,
  D2_VALBRUT,
  (D2_CLIENTE || D2_LOJA) idCliente,
  B.R_E_C_N_O_,
  B.D_E_L_E_T_ DELETADO_SD2,
  TO_CHAR(
    TO_DATE('19960101', 'YYYYMMDD') + (
      (ASCII(SUBSTR(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGI, 16, 1)) - 50)
    ),
    'YYYYMMDD'
  ) AS DATA_INCLUSAO,
  TO_CHAR(
    TO_DATE('19960101', 'YYYYMMDD') + (
      (ASCII(SUBSTR(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGA, 16, 1)) - 50)
    ),
    'YYYYMMDD'
  ) AS DATA_ALTERACAO
FROM
  SD2010 B
  INNER JOIN SF2010 X ON X.F2_DOC = B.D2_DOC
  AND X.F2_SERIE = B.D2_SERIE
  AND X.F2_FILIAL = B.D2_FILIAL
  AND X.F2_CLIENTE = B.D2_CLIENTE
  AND X.F2_LOJA = B.D2_LOJA
  AND X.F2_EMISSAO = B.D2_EMISSAO
  AND X.D_E_L_E_T_ <> '*'
  INNER JOIN SA1010 F ON F.A1_COD = B.D2_CLIENTE
  AND F.D_E_L_E_T_ <> '*'
  INNER JOIN SB1010 L ON L.B1_COD = B.D2_COD
  AND L.D_E_L_E_T_ <> '*'
WHERE
  B.D2_USERLGI <> ' '
  AND (
    TO_CHAR(
      TO_DATE('19960101', 'YYYYMMDD') + (
        (ASCII(SUBSTR(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGI, 16, 1)) - 50)
      ),
      'YYYYMMDD'
    ) >= '20210922'
    AND TO_CHAR(
      TO_DATE('19960101', 'YYYYMMDD') + (
        (ASCII(SUBSTR(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGI, 16, 1)) - 50)
      ),
      'YYYYMMDD'
    ) <= '20210924'
    OR TO_CHAR(
      TO_DATE('19960101', 'YYYYMMDD') + (
        (ASCII(SUBSTR(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGA, 16, 1)) - 50)
      ),
      'YYYYMMDD'
    ) >= '20210922'
    AND TO_CHAR(
      TO_DATE('19960101', 'YYYYMMDD') + (
        (ASCII(SUBSTR(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGA, 16, 1)) - 50)
      ),
      'YYYYMMDD'
    ) <= '20210924'
  )