   SELECT * FROM (SELECT
   0 AS TIPOQUERY,
(CASE D2_FILIAL
    WHEN '010101' THEN '010101'
    WHEN '010102' THEN '010102'
    ELSE NULL
  END) as CNPJORIGEMDADOS
        ,(D2_FILIAL || D2_DOC || D2_SERIE || D2_EMISSAO || D2_CLIENTE || D2_LOJA || D2_ITEM) ID
        ,B1_DESC
        ,B1_COD
        ,D2_DOC
        ,D2_SERIE
        ,D2_EMISSAO
        ,D2_PEDIDO
        ,(CASE D2_TIPO
        WHEN 'N' THEN '1'
        WHEN 'D' THEN '0'
        WHEN 'P' THEN '2'
        WHEN 'I' THEN '2'
        WHEN 'C' THEN '1'
        WHEN 'B' THEN '2'
        ELSE NULL
         END) D2_TIPO
        ,D2_COD
        ,D2_UM
        ,D2_QUANT
        ,CAST(D2_PRCVEN  AS VARCHAR(10)) AS PRCVEN
        ,CAST(D2_VALBRUT  AS VARCHAR(10)) AS VALBRUT
        ,(D2_CLIENTE || D2_LOJA) IDCLIENTE
        ,null IDNOTAFISCALORIGEM
        ,null NOTAFISCALORIGEM
        ,B.R_E_C_N_O_
    ,A1_CGC
    ,CAST(D2_DESC  AS VARCHAR(10)) AS DESCONT
    ,CAST(D2_TOTAL  AS VARCHAR(10)) AS TOTAL
    ,D2_CF
        ,B.D_E_L_E_T_ DELETADO
        ,TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGI, 16, 1)) - 50)), 'YYYYMMDD')   as DATA_INCLUSAO
        ,TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGA, 16, 1)) - 50)), 'YYYYMMDD')   as DATA_ATUALIZACAO
FROM SD2010 B
INNER JOIN SF2010 X ON X.F2_DOC = B.D2_DOC
        AND X.F2_SERIE = B.D2_SERIE
        AND X.F2_FILIAL = B.D2_FILIAL
        AND X.F2_CLIENTE = B.D2_CLIENTE
        AND X.F2_LOJA = B.D2_LOJA
        AND X.F2_EMISSAO = B.D2_EMISSAO
        AND X.D_E_L_E_T_ <> '*'
INNER JOIN SA1010 F ON F.A1_COD = B.D2_CLIENTE
        AND F.D_E_L_E_T_ <> '*'
INNER JOIN SB1010 L ON L.B1_COD = B.D2_COD
        AND L.D_E_L_E_T_ <> '*'
WHERE B.D2_USERLGI <> ' '
        AND (
        (
          TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGI, 16, 1)) - 50)), 'YYYYMMDD') >= '20211004'
          AND TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D2_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGI, 16, 1)) - 50)), 'YYYYMMDD') <= '20211011'
        )
        OR
        (
          TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGA, 16, 1)) - 50)), 'YYYYMMDD') >= '20211004'
          AND TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D2_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D2_USERLGA, 16, 1)) - 50)), 'YYYYMMDD') <= '20211011'
        )
    )
 UNION ALL
        SELECT
		1 AS TIPOQUERY,
(CASE D1_FILIAL
    WHEN '010101' THEN '010101'
    WHEN '010102' THEN '010102'
    ELSE NULL
  END) as CNPJORIGEMDADOS
        ,(D1_FILIAL || D1_DOC || D1_SERIE || D1_EMISSAO || D1_FORNECE || D1_LOJA || D1_ITEM) ID
        ,B1_DESC
        ,B1_COD
        ,D1_DOC
        ,D1_SERIE
        ,D1_EMISSAO
        ,D1_PEDIDO
        ,(CASE D1_TIPO
        WHEN 'N' THEN '1'
        WHEN 'D' THEN '0'
        WHEN 'P' THEN '2'
        WHEN 'I' THEN '2'
        WHEN 'C' THEN '1'
        wHEN 'B' THEN '2'
        ELSE NULL
         END) D1_TIPO
        ,D1_COD
    ,D1_UM
        ,D1_QUANT
        ,CAST(D1_VUNIT  AS VARCHAR(10)) AS PRCVEN
        ,CAST(D1_TOTAL  AS VARCHAR(10)) AS VALBRUT
        ,CONCAT ( D1_FORNECE ,D1_LOJA ) IDCLIENTE
        ,(F2_FILIAL || F2_DOC || F2_SERIE || F2_CLIENTE || F2_LOJA || F2_EMISSAO || F2_CHVNFE || F2_IDNF) IDNOTAFISCALORIGEM
        ,D1_NFORI AS NOTAFISCALORIGEM
        ,B.R_E_C_N_O_
    ,A1_CGC
    ,CAST(D1_DESC  AS VARCHAR(10)) AS DESCONT
    ,CAST(D1_TOTAL  AS VARCHAR(10)) AS TOTAL
    ,D1_CF
        ,B.D_E_L_E_T_ DELETADO                                                                                                                                          
        ,TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D1_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D1_USERLGI, 16, 1)) - 50)), 'YYYYMMDD')   as DATA_INCLUSAO
        ,TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D1_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D1_USERLGA, 16, 1)) - 50)), 'YYYYMMDD')   as DATA_ATUALIZACAO
FROM SD1010 B
INNER JOIN SA1010 X ON X.A1_COD = B.D1_FORNECE
        AND X.A1_LOJA = B.D1_LOJA
        AND X.D_E_L_E_T_ <> '*'
INNER JOIN SB1010 O ON O.B1_COD = B.D1_COD
        AND O.D_E_L_E_T_<> '*'
INNER JOIN SF2010 S ON S.F2_FILIAL = B.D1_FILIAL
        AND S.F2_DOC = B.D1_NFORI
        AND S.F2_SERIE = B.D1_SERIORI
        AND S.D_E_L_E_T_ <> '*'
INNER JOIN SF1010 Z ON Z.F1_DOC = B.D1_DOC
        AND Z.F1_SERIE = B.D1_SERIE
        AND Z.F1_FILIAL = B.D1_FILIAL
        AND Z.F1_FORNECE = B.D1_FORNECE
        AND Z.F1_LOJA = B.D1_LOJA
        AND Z.F1_EMISSAO = B.D1_EMISSAO
        AND Z.D_E_L_E_T_ <> '*'
WHERE B.D1_USERLGI <> ' '
        AND (
        (
          TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D1_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D1_USERLGI, 16, 1)) - 50)), 'YYYYMMDD') >= '20211004'
          AND TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D1_USERLGI, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D1_USERLGI, 16, 1)) - 50)), 'YYYYMMDD') <= '20211011'
        )
        OR
        (
          TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D1_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D1_USERLGA, 16, 1)) - 50)), 'YYYYMMDD') >= '20211004'
          AND TO_CHAR(TO_DATE('19960101', 'YYYYMMDD') + ((ASCII(SUBSTR(B.D1_USERLGA, 12, 1)) - 50) * 100 + (ASCII(SUBSTR(B.D1_USERLGA, 16, 1)) - 50)), 'YYYYMMDD') <= '20211011'
        )
    )
        AND D1_NFORI <> ' '
)  ORDER BY TIPOQUERY ASC, R_E_C_N_O_ ASC